# Contributor: Alexandre Petitjean <alpetitjean@gmail.com>

_gitname=qtserialport
_gitroot='git://gitorious.org/qt/qtserialport.git'

pkgname=qtserialport-qt4-git
pkgver=20130331
pkgrel=3
pkgdesc="Add-on for the Qt4 library, providing a single interface for both hardware and virtual serial ports"
arch=('i686' 'x86_64')
url="http://qt-project.org/wiki/QtSerialPort"
license=('LGPL')
depends=('qt4')
makedepends=('git')
provides=('qtserialport-qt4')

build() {
	cd "$srcdir"
	if [[ -d "${_gitname}" ]]; then
		cd "${_gitname}" && git pull origin
		msg "The local files are updated."
	else
		git clone --depth=1 "${_gitroot}" "${_gitname}" && cd "${_gitname}"
		msg "GIT checkout done or server timeout"
	fi
	cd "$srcdir"

	# don't build examples and tests
	sed -i 's/ examples tests//' ${_gitname}/${_gitname}.pro

	# Replace target to match Qt4
	sed -i 's/QtSerialPort\$\$/Qt4SerialPort\$\$/g' ${_gitname}/src/serialport/serialport.pro
	sed -i 's/qtAddLibrary(QtSerialPort)/qtAddLibrary(Qt4SerialPort)/g' ${_gitname}/src/serialport/qt4support/serialport.prf

	# Build
	cd "$srcdir"/${_gitname}
	qmake-qt4
	make
}

package() {
  cd "$srcdir"/${_gitname}
  make INSTALL_ROOT="$pkgdir" install

  sed -i '1,1d' "$pkgdir"/usr/lib/libQt4SerialPort.prl
}
